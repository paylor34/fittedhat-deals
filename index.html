<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinite Hat Deals</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; }
        .hat { background: white; border-radius: 12px; margin-bottom: 20px; display: flex; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); transition: transform 0.2s; }
        .hat:hover { transform: translateY(-2px); }
        
        /* Clickable image area */
        .hat-link-wrapper { flex-shrink: 0; width: 150px; height: 150px; margin-right: 20px; }
        .hat img { width: 100%; height: 100%; object-fit: cover; border-radius: 8px; cursor: pointer; }
        
        .hat-info { flex: 1; display: flex; flex-direction: column; justify-content: center; }
        .price { font-size: 1.4em; color: #2ecc71; font-weight: bold; }
        .orig { text-decoration: line-through; color: #95a5a6; font-size: 0.9em; }
        
        .buy-btn { background: #e67e22; color: white; border: none; padding: 12px; border-radius: 6px; 
                   cursor: pointer; font-weight: bold; margin-top: 10px; text-decoration: none; text-align: center; }
        
        .loading-trigger { height: 100px; display: flex; align-items: center; justify-content: center; color: #7f8c8d; }
    </style>
</head>
<body>

    <h1>New Era Sale Feed</h1>
    <div id="deals-container"></div>
    
    <div id="sentinel" class="loading-trigger">
        <p id="status-text">Loading more fire deals...</p>
    </div>

    <script>
        let page = 1;
        let isFetching = false;
        const container = document.getElementById('deals-container');
        const statusText = document.getElementById('status-text');

        // 1. Function to fetch data from your API/Source
        async function loadMoreHats() {
            if (isFetching) return;
            isFetching = true;

            try {
                /* REPLACE the URL below with your actual data source.
                   Example: 'fetch_hats.php?page=' + page
                */
                const response = await fetch(`https://api.example.com/deals?page=${page}`);
                const data = await response.json();

                if (data.length === 0) {
                    statusText.innerText = "You've seen it all!";
                    observer.unobserve(sentinel); // Stop looking for the bottom
                    return;
                }

                renderHats(data);
                page++;
            } catch (error) {
                console.error("Fetch error:", error);
                statusText.innerText = "Couldn't load more. Check connection.";
                
                // MOCK DATA: Remove this block once your real API is working
                if(page < 5) { 
                    const mock = [
                        { name: "Sample Hat " + (page * 3), price: "$19", link: "#", img: "https://via.placeholder.com/150" },
                        { name: "Sample Hat " + (page * 3 + 1), price: "$22", link: "#", img: "https://via.placeholder.com/150" }
                    ];
                    renderHats(mock);
                    page++;
                }
            } finally {
                isFetching = false;
            }
        }

        // 2. Function to build the HTML and handle clicks
        function renderHats(hatList) {
            hatList.forEach(hat => {
                const hatElement = `
                    <div class="hat">
                        <a href="${hat.link}" target="_blank" class="hat-link-wrapper">
                            <img src="${hat.img}" alt="${hat.name}" title="View Deal">
                        </a>
                        <div class="hat-info">
                            <h3>${hat.name}</h3>
                            <div class="price">${hat.price}</div>
                            <a href="${hat.link}" target="_blank" class="buy-btn">GET DEAL</a>
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', hatElement);
            });
        }

        // 3. The Intersection Observer (The "Never Ending" Engine)
        const sentinel = document.getElementById('sentinel');
        const observer = new IntersectionObserver((entries) => {
            // If the sentinel (bottom div) enters the screen, load more data
            if (entries[0].isIntersecting) {
                loadMoreHats();
            }
        }, { threshold: 0.1 });

        observer.observe(sentinel);
    </script>
</body>
</html>
